p8105\_hw5\_yw3236
================
Yishan Wang
2018-11-02

``` r
library(tidyverse)
```

    ## -- Attaching packages ------------------------------------------------------------------ tidyverse 1.2.1 --

    ## <U+221A> ggplot2 3.1.0     <U+221A> purrr   0.2.5
    ## <U+221A> tibble  1.4.2     <U+221A> dplyr   0.7.6
    ## <U+221A> tidyr   0.8.1     <U+221A> stringr 1.3.1
    ## <U+221A> readr   1.1.1     <U+221A> forcats 0.3.0

    ## -- Conflicts --------------------------------------------------------------------- tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(rvest)
```

    ## Loading required package: xml2

    ## 
    ## Attaching package: 'rvest'

    ## The following object is masked from 'package:purrr':
    ## 
    ##     pluck

    ## The following object is masked from 'package:readr':
    ## 
    ##     guess_encoding

``` r
multmerge = function(mypath){
  
  filenames = list.files(path = mypath, full.names = TRUE)  #read file namesas a list
  datalist = lapply(filenames, function(x){read.csv(file = x, header = T)})  #read each .csv file
  names(datalist) = filenames  
  for (i in filenames) {
    datalist[[i]]$source = i
  }  #create a new column in each element of the list
  Reduce(function(x, y){rbind(x, y)}, datalist)  #combine all elements of the list
  
}
```

``` r
mergeddata = multmerge("./data")
```

``` r
format_merged_data = mergeddata %>%
  mutate(source = gsub("^./data/", " ", source)) %>%
  mutate(source = gsub(".csv$", " ", source)) %>%
  mutate(arm = gsub("([A-Za-z]+).*", "\\1", source)) %>%  #have arm column
  mutate(id = gsub("con_", " ", source)) %>%
  mutate(id = gsub("exp_", " ", id)) %>%
  mutate(id = as.numeric(id)) %>%  #have numeric id column
  select(-source) %>%
  gather(key = week, value = obs, week_1:week_8) %>%
  select(id, arm, week, obs) #tidy dataset
```

View(format\_merged\_data)
