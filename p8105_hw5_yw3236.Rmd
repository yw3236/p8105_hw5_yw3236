---
title: "p8105_hw5_yw3236"
output: github_document
author: "Yishan Wang"
date: "2018-11-02"
---

```{r}
library(tidyverse)
library(rvest)
```

```{r}
multmerge = function(mypath){
  
  filenames = list.files(path = mypath, full.names = TRUE)  #read file namesas a list
  datalist = lapply(filenames, function(x){read.csv(file = x, header = T)})  #read each .csv file
  names(datalist) = filenames  
  for (i in filenames) {
    datalist[[i]]$source = i
  }  #create a new column in each element of the list
  Reduce(function(x, y){rbind(x, y)}, datalist)  #combine all elements of the list
  
}
```

```{r}
mergeddata = multmerge("./data")
```

```{r}
format_merged_data = mergeddata %>%
  mutate(source = gsub("^./data/", " ", source)) %>%
  mutate(source = gsub(".csv$", " ", source)) %>%
  mutate(arm = gsub("([A-Za-z]+).*", "\\1", source)) %>%  #have arm column
  mutate(id = gsub("con_", " ", source)) %>%
  mutate(id = gsub("exp_", " ", id)) %>%
  mutate(id = as.numeric(id)) %>%  #have numeric id column
  select(-source) %>%
  gather(key = week, value = obs, week_1:week_8) %>%
  select(id, arm, week, obs) #tidy dataset
  
```
View(format_merged_data)