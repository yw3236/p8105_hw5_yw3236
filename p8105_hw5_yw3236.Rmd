---
title: "p8105_hw5_yw3236"
output: github_document
author: "Yishan Wang"
date: "2018-11-02"
---

# Problem 1

```{r include = FALSE}
library(tidyverse)
library(rvest)
library(httr)
```

```{r}
multmerge = function(mypath){

  filenames = list.files(path = mypath, full.names = TRUE)  #read file names as a list
  data = data_frame(filenames) %>%  #create a dataframe
    mutate(file_contents = purrr::map(filenames, function(x){read.csv(file = x, header = T)})) %>%  #read each file
    unnest()  #unnest each file
  
}
```

This is the second method that using for loop to create filenames column. (`eval=FALSE`)
```{r eval=FALSE}
multmerge = function(mypath){

  filenames = list.files(path = mypath, full.names = TRUE)  #read file names as a list
  datalist = purrr::map(filenames, function(x){read.csv(file = x, header = T)})  #read each csv file and store as a list
  names(datalist) = filenames
  names(datalist) = filenames
  for (i in filenames) {
   datalist[[i]]$filenames = i  #create a new column for file names
  }
  Reduce(function(x, y){rbind(x, y)}, datalist)  #combine all elements of the list

}
```

```{r}
mergeddata = multmerge("./data")
```

```{r}
format_merged_data = mergeddata %>%
  mutate(filenames = gsub("^./data/", " ", filenames)) %>%
  mutate(filenames = gsub(".csv$", " ", filenames)) %>%
  mutate(arm = gsub("([A-Za-z]+).*", "\\1", filenames)) %>%  #have arm column
  mutate(id = gsub("con_", " ", filenames)) %>%
  mutate(id = gsub("exp_", " ", id)) %>%
  mutate(id = as.numeric(id)) %>%  #have numeric id column
  select(-filenames) %>%
  gather(key = week, value = obs, week_1:week_8) %>%
  select(id, arm, week, obs) #tidy dataset
```

```{r}
format_merged_data %>%
  group_by(id) %>%  #group by id
  ggplot() +
  geom_line(aes(x = week, y = obs, group = id, color = id)) +
  facet_grid(~arm) +  #compare two groups: con and exp
  labs(x = "Week", y = "Observations")
```

### Comment

# Problem 2

### Describe Data

```{r}
homicides_data = read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")
```
View(homicides_data)
```{r}
homicides_data %>%
  mutate(city_state = paste(city, state, sep = ", ")) %>%
  mutate(disposition_index = ifelse(disposition == "Closed without arrest" | disposition == "Open/No arrest", 1, 0)) %>%  #create a index 
  group_by(city) %>%
  summarise(total_homicides = n(), unsolved_homicides = sum(disposition_index))  #summarize total homicides and unsolved homicides
```
